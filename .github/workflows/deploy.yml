name: Deploy to Simply.com

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    
    - name: Install sshpass
      run: |
        sudo apt-get update
        sudo apt-get install sshpass
    
    - name: Configure SSH
      run: |
        mkdir ~/.ssh
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ./id_rsa
        chmod 600 id_rsa
        cp id_rsa id_rsa.pem
        ssh-keyscan linux279.unoeuro.com >> ~/.ssh/known_hosts
    
    - name: Deploy to Simply.com
      run: |
        sshpass -p zpmt5dhg ssh -i ~/.ssh/id_rsa.pem danishxboxleagu.dk@linux279.unoeuro.com 'cd /staging/wp-content/plugins/dxl-api && git pull'
